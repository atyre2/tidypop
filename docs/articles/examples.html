<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tidypop examples • tidypop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="tidypop examples">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidypop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/examples.html">tidypop examples</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/atyre2/tidypop">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>tidypop examples</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/atyre2/tidypop/blob/master/vignettes/examples.Rmd"><code>vignettes/examples.Rmd</code></a></small>
      <div class="hidden name"><code>examples.Rmd</code></div>

    </div>

    
    
<p>Demonstrate the use of <code>tidypop</code> for a range of ecological models, showing how to include stochasticity, time dependence, and make plots.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidypop)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)</a></code></pre></div>
<div id="exponential-growth" class="section level1">
<h1 class="hasAnchor">
<a href="#exponential-growth" class="anchor"></a>Exponential growth</h1>
<p><code>tidypop</code> uses discrete time, but <a href="https://drewtyre.rbind.io/post/geometric-vs-exponential-growth-models-a-zombie-idea/">I think the distinction between exponential and geometric growth is meaningless</a>. The formula for the model is <span class="math display">\[
N_{t+1} = N_{t}e^{r_t}
\]</span> and in code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">exppop &lt;-<span class="st"> </span><span class="cf">function</span>(N0, r){</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  N1 &lt;-<span class="st"> </span>N0<span class="op">*</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(r)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(N1)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">}</a></code></pre></div>
<p><code><a href="../reference/iterate.html">tidypop::iterate()</a></code> needs a tibble or dataframe with one row for each timestep. The name is arbitrary, but I call it parms. There must be one column for each argument to <code>exppop()</code> other than <code>N0</code>. It can be useful for plotting to include some kind of label for each timestep.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">parms &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">t =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">r =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="fl">0.05</span>, <span class="dv">20</span>))</a></code></pre></div>
<p>With those two pieces we can now use iterate to add a column with the projected population size called N. We also have to choose a starting population size.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/iterate.html">iterate</a></span>(parms, <span class="dv">33</span>, exppop)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(results)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;       t     r     N</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; 1     1  0.05  33  </span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; 2     2  0.05  34.7</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; 3     3  0.05  36.5</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 4     4  0.05  38.3</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; 5     5  0.05  40.3</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; 6     6  0.05  42.4</span></a></code></pre></div>
<p>Making a plot is very straightforward with ggplot</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> results,</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">       <span class="dt">mapping =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> t, <span class="dt">y =</span> N)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>()</a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>or with base R</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(N <span class="op">~</span><span class="st"> </span>t, <span class="dt">data =</span> results)</a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="stochasticity" class="section level1">
<h1 class="hasAnchor">
<a href="#stochasticity" class="anchor"></a>Stochasticity</h1>
<p>To demonstrate how to add stochasticity using <code>tidypop</code>, I will use some real data to start with.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">grizzly &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">Year =</span> <span class="dv">1976</span><span class="op">:</span><span class="dv">2007</span>,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">                      <span class="dt">N=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">33</span>, <span class="dv">36</span>, <span class="dv">34</span>, <span class="dv">39</span>, <span class="dv">35</span>, <span class="dv">34</span>, <span class="dv">38</span>, <span class="dv">36</span>, <span class="dv">37</span>, <span class="dv">41</span>, <span class="dv">39</span>, <span class="dv">51</span>, <span class="dv">47</span>, <span class="dv">57</span>, <span class="dv">48</span>, <span class="dv">60</span>, <span class="dv">65</span>,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="dv">74</span>, <span class="dv">69</span>, <span class="dv">65</span>, <span class="dv">57</span>, <span class="dv">70</span>, <span class="dv">81</span>, <span class="dv">99</span>, <span class="dv">99</span>, <span class="dv">105</span>, <span class="dv">112</span>, <span class="dv">131</span>, <span class="dv">132</span>, <span class="dv">139</span>, <span class="dv">118</span>, <span class="dv">127</span>))</a></code></pre></div>
<p>These data are a 3-yr running sum of the numbers of unduplicated grizzly bear females observed with cubs-of-the-year, 1973-2006, in the greater Yellowstone ecosystem (Table 4 from Schwartz, C.C., M. A. Haroldson, and K. West, eds. 2006. Yellowstone grizzly bear investigations: annual report of the Interagency Grizzly Bear Study Team, 2006. US Geological Survey, Bozeman, Montana, USA). First observation is sum of 1973-74-75 counts, second is 1974-75-76, etc. Compare with Table 3 of Dennis and Taper (1994), which ends at 1991 and used an unofficial count for 1990 reported by IGBST via phone. Obtained from <a href="http://www.webpages.uidaho.edu/~brian/reprints/density_dependence_PBLR_test.pdf">Brian Dennis’ website on May 13, 2017.</a></p>
<p><img src="examples_files/figure-html/introplot-1.png" width="700"></p>
<p>There are 3 sources of variability here: sampling error in population estimation, environmental stochasticity, and demographic stochasticity.</p>
<div id="sampling-error---epistemic-uncertainty" class="section level2">
<h2 class="hasAnchor">
<a href="#sampling-error---epistemic-uncertainty" class="anchor"></a>Sampling error - Epistemic uncertainty</h2>
<p>Sampling error means that our estimate of the average rate of growth is uncertain, that is, <span class="math inline">\(\bar{r}\)</span> is a random variable with some variance. One way we can proceed is to assume that <em>all</em> of the variation in the graph is sampling error. There is one true value of <span class="math inline">\(r\)</span> at all times, but we don’t know what it is. So, calculate the per capita rate of population growth for all years, and calculate the mean and standard error. <span class="math display">\[
r_t = log\left(\frac{n_{t+1}}{n_t}\right)
\]</span></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">grizzly &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(grizzly,</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">       <span class="dt">r =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lead</a></span>(N)<span class="op">/</span>N))</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">sumry_griz &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(grizzly,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">          <span class="dt">rbar =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(r, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">          <span class="dt">r_se =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(r, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>()<span class="op">-</span><span class="dv">1</span>)) </a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co"># test it out -- assumes you saved summary stats in data_frame called sumry_griz</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">parms &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">t =</span> <span class="dv">1976</span><span class="op">:</span><span class="dv">2007</span>,</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">                <span class="dt">r =</span> sumry_griz<span class="op">$</span>rbar)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="kw"><a href="../reference/iterate.html">iterate</a></span>(<span class="dt">parms =</span> parms, <span class="dt">N0 =</span> <span class="dv">33</span>, <span class="dt">popfun =</span> exppop))</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;       t      r     N</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt; 1  1976 0.0435  33  </span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt; 2  1977 0.0435  34.5</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; 3  1978 0.0435  36.0</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; 4  1979 0.0435  37.6</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; 5  1980 0.0435  39.3</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; 6  1981 0.0435  41.0</span></a></code></pre></div>
<p>We need to run the model with many different values of <span class="math inline">\(r\)</span>, sampled from the distribution of uncertainty we have for <span class="math inline">\(\bar{r}\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">nyears &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="dv">1976</span><span class="op">:</span><span class="dv">2007</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">bigparms &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="dt">t =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1976</span><span class="op">:</span><span class="dv">2007</span>, <span class="dt">times =</span> <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                  <span class="dt">r =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">100</span>, sumry_griz<span class="op">$</span>rbar, sumry_griz<span class="op">$</span>r_se), <span class="dt">each =</span> nyears)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">                  )</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co"># split() breaks up a dataframe according to the values of f, into a list of smaller dataframe</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co"># map_dfr() is a new function</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co"># map_dfr() is like map but already glues results back into a data frame</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">bigresults &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/split">split</a></span>(bigparms, <span class="dt">f =</span> bigparms<span class="op">$</span>r) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(<span class="op">~</span><span class="kw"><a href="../reference/iterate.html">iterate</a></span>(<span class="dt">parms =</span> ., <span class="dt">N0=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">N =</span> <span class="dv">33</span>), <span class="dt">popfun =</span> exppop), <span class="dt">.id =</span> <span class="st">"rep"</span>)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co"># plot them all</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> grizzly,</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">       <span class="dt">mapping =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> Year, <span class="dt">y=</span>N)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">data =</span> bigresults,</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">            <span class="dt">mapping =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> t, <span class="dt">y =</span> N, <span class="dt">group=</span>rep),</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">            <span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() </a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="environmental-stochasticity" class="section level2">
<h2 class="hasAnchor">
<a href="#environmental-stochasticity" class="anchor"></a>Environmental stochasticity</h2>
<p>We could also assume that all the variation in the graph is caused by variation in birth and death rates between years. Now we also draw random samples of <span class="math inline">\(r\)</span>, but we get a new value for each year, and pass that to our model as a vector.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">lotsofr &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">rep =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">each=</span>nyears),</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">                  <span class="dt">t =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1976</span><span class="op">:</span><span class="dv">2007</span>, <span class="dt">times =</span> <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                  <span class="dt">r =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">100</span><span class="op">*</span>nyears, sumry_griz<span class="op">$</span>rbar, sumry_griz<span class="op">$</span>r_se))</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">bigresults2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/split">split</a></span>(lotsofr, <span class="dt">f =</span> lotsofr<span class="op">$</span>rep) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="op">~</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(., <span class="op">-</span>rep)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#awkward, sorry</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(<span class="op">~</span><span class="kw"><a href="../reference/iterate.html">iterate</a></span>(<span class="dt">parms =</span> ., <span class="dt">N0=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">N =</span> <span class="dv">33</span>), <span class="dt">popfun =</span> exppop), <span class="dt">.id =</span> <span class="st">"rep"</span>)</a>
<a class="sourceLine" id="cb10-8" data-line-number="8"></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co"># plot them all</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> grizzly,</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">       <span class="dt">mapping =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> Year, <span class="dt">y=</span>N)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">data =</span> bigresults2,</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">            <span class="dt">mapping =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> t, <span class="dt">y =</span> N, <span class="dt">group=</span>rep),</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">            <span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() </a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="demographic-stochasticity" class="section level2">
<h2 class="hasAnchor">
<a href="#demographic-stochasticity" class="anchor"></a>Demographic stochasticity</h2>
<p>Demographic stochasticity requires more work, because within our function we have to randomly choose how many individuals live, die, and give birth. We assume births happen before deaths.</p>
<p><span class="math display">\[
\begin{aligned}
N_{t+1} = &amp; N_{t} + bN_{t}- dN_{t} \\
N_{t+1} = &amp; N_{t}(1 + b - d) \\
N_{t+1} = &amp; N_{t}\lambda = N_{t}e^{r}
\end{aligned}
\]</span></p>
<p>Here <span class="math inline">\(\lambda\)</span> is the ratio of population size between two times. <span class="math inline">\(log(\lambda) = r\)</span>, the intrinsic population growth rate. We will use the first version of the equation, because we want to manipulate <span class="math inline">\(b\)</span> and <span class="math inline">\(d\)</span> separately. Births will occur with a Poisson distribution with mean b*N. Deaths are binomial and occur with a probability <span class="math inline">\(1-e^{-d}\)</span><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">stch_exppop &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">N0 =</span> <span class="dv">10</span>, t, <span class="dt">b =</span> <span class="fl">0.2</span>, <span class="dt">d =</span> <span class="fl">0.1</span>){</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  births &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">rpois</a></span>(<span class="dv">1</span>, b<span class="op">*</span>N0)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  deaths &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Binomial">rbinom</a></span>(<span class="dv">1</span>, N0, <span class="dv">1</span><span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span>d))</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  N1 &lt;-<span class="st"> </span>N0 <span class="op">+</span><span class="st"> </span>births <span class="op">-</span><span class="st"> </span>deaths</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(N1)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">}</a></code></pre></div>
<p>We can get the mean correct by remembering that <span class="math inline">\(b-d = r\)</span>. Before we assumed that <span class="math inline">\(d = 0\)</span>, but now we have to have a value bigger than zero (more realistic). The average trajectory will be unaffected by the values we pick, as long as the difference is <span class="math inline">\(\bar{r} = 0.0435\)</span> but the variance will change. If we choose <span class="math inline">\(d = 0.2\)</span> then <span class="math inline">\(b = 0.243\)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">bigparms2 &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">rep =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">each =</span> nyears),</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">                   <span class="dt">t =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1976</span><span class="op">:</span><span class="dv">2007</span>, <span class="dt">times =</span> <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">                   <span class="dt">b =</span> <span class="fl">0.2</span><span class="op">+</span>sumry_griz<span class="op">$</span>rbar,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">                   <span class="dt">d =</span> <span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co"># split() breaks up a dataframe according to the values of f, into a list of smaller dataframe</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co"># map_dfr() is a new function</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co"># map_dfr() is like map but already glues results back into a data frame</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">bigresults2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/split">split</a></span>(bigparms2, <span class="dt">f =</span> bigparms2<span class="op">$</span>rep) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="op">~</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(., <span class="op">-</span>rep)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(<span class="op">~</span><span class="kw"><a href="../reference/iterate.html">iterate</a></span>(<span class="dt">parms =</span> ., <span class="dt">N0=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">N =</span> <span class="dv">33</span>), <span class="dt">popfun =</span> stch_exppop), <span class="dt">.id =</span> <span class="st">"rep"</span>)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co"># plot them all</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="dt">data =</span> grizzly,</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">       <span class="dt">mapping =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> Year, <span class="dt">y=</span>N)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">data =</span> bigresults2,</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">            <span class="dt">mapping =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> t, <span class="dt">y =</span> N, <span class="dt">group=</span>rep),</a>
<a class="sourceLine" id="cb12-17" data-line-number="17">            <span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() </a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>That looks like the mean is maybe a bit high. Let’s check.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">bigresults2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(rep) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">r =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lead</a></span>(N)<span class="op">/</span>N)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">rbar =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(r, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">            <span class="dt">r_se =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(r, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)<span class="op">/</span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>()<span class="op">-</span><span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="dt">mapping =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> rbar), <span class="dt">binwidth =</span> <span class="fl">0.01</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="dt">xintercept =</span> sumry_griz<span class="op">$</span>rbar, <span class="dt">color =</span> <span class="st">"red"</span>, <span class="dt">linetype=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>So it is a bit high. That’s probably because of “non-linear averaging”.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">nla &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">r =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="fl">0.0</span>, <span class="fl">0.1</span>, <span class="fl">0.001</span>),</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">              <span class="dt">N32 =</span> <span class="dv">33</span><span class="op">*</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(r<span class="op">*</span><span class="dv">32</span>))</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(nla,</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">       <span class="dt">mapping =</span> <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> r, <span class="dt">y =</span> N32)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()</a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Population size as a function of <em>r</em> is concave up, so if <em>r</em> is varying randomly, the average of the growth rates is higher than the growth at the average rate. The variation induced by our demographic stochastic model might be too high as well.</p>
</div>
<div id="structured-population-models" class="section level2">
<h2 class="hasAnchor">
<a href="#structured-population-models" class="anchor"></a>Structured Population Models</h2>
<p>The argument N0 can be specified as a vector, enabling us to use structured population models. The projection matrix <span class="math inline">\(A\)</span> needs to be stored in a list-column of the input parameters. So</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># create the projection matrix</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">A &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">              <span class="fl">0.75</span>, <span class="dv">0</span>, <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">              <span class="dv">0</span>, <span class="fl">0.9</span>, <span class="fl">0.9</span>), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co"># store it in the tibble as a replicated list</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">inputs &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">t =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">                 <span class="dt">A =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(A), <span class="dv">20</span>))</a>
<a class="sourceLine" id="cb15-8" data-line-number="8"></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co"># create the one line function</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10">project_matrix &lt;-<span class="st"> </span><span class="cf">function</span>(N0, A){</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">  <span class="co"># need to add [[1]] to "unlist" A</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12">  A[[<span class="dv">1</span>]] <span class="op">%*%</span><span class="st"> </span>N0  <span class="co"># matrix multiply and return result</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="kw"><a href="../reference/iterate.html">iterate</a></span>(inputs, <span class="dt">N0 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), project_matrix))</a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co">#&gt;       t A                    N1    N2    N3</span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">#&gt;   &lt;int&gt; &lt;list&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="co">#&gt; 1     1 &lt;dbl[,3] [3 × 3]&gt;  1     1     1   </span></a>
<a class="sourceLine" id="cb15-19" data-line-number="19"><span class="co">#&gt; 2     2 &lt;dbl[,3] [3 × 3]&gt;  1     0.75  1.8 </span></a>
<a class="sourceLine" id="cb15-20" data-line-number="20"><span class="co">#&gt; 3     3 &lt;dbl[,3] [3 × 3]&gt;  1.8   0.75  2.30</span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21"><span class="co">#&gt; 4     4 &lt;dbl[,3] [3 × 3]&gt;  2.30  1.35  2.74</span></a>
<a class="sourceLine" id="cb15-22" data-line-number="22"><span class="co">#&gt; 5     5 &lt;dbl[,3] [3 × 3]&gt;  2.74  1.72  3.68</span></a>
<a class="sourceLine" id="cb15-23" data-line-number="23"><span class="co">#&gt; 6     6 &lt;dbl[,3] [3 × 3]&gt;  3.68  2.06  4.86</span></a></code></pre></div>
<div id="stochastic-projection-matrices" class="section level3">
<h3 class="hasAnchor">
<a href="#stochastic-projection-matrices" class="anchor"></a>Stochastic projection matrices</h3>
<p>I will use some matrices calculated from some data for helmeted honeyeaters. <img src="images/HH-sqwak-threat-spec-web620.jpg" alt="Helmeted Honeyeater threat display. Image by Trent Browning"></p>
<p>This bird is critically endangered, restricted to 3 small populations just east of Melbourne. Zoos Victoria contributes to conservation by captive rearing individuals to supplement wild populations, as well as maintaining a captive population “lifeboat” for the species. The matrices are stored in a list <code>hh_A</code>, and the associated population vectors are in <code>hh_N</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">big_list_matrices &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">t =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">                            <span class="dt">A =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(hh_A, <span class="dv">20</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>)) <span class="co"># pick a matrix randomly 20 times</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co"># make the projections using matrix multiplication</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">stoch_proj &lt;-<span class="st"> </span><span class="cf">function</span>(N0, A, t){</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">  N1 &lt;-<span class="st"> </span>A[[<span class="dv">1</span>]] <span class="op">%*%</span><span class="st"> </span>N0 <span class="co"># the [[1]] extracts the matrix from the list</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(N1)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">onerep &lt;-<span class="st"> </span><span class="kw"><a href="../reference/iterate.html">iterate</a></span>(<span class="dt">parms =</span> big_list_matrices, <span class="dt">N0 =</span> hh_N<span class="op">$</span>N1991, <span class="dt">popfun =</span> stoch_proj)</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">stoch_summary &lt;-<span class="st"> </span>onerep <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="dt">key =</span> <span class="st">"ageclass"</span>, <span class="dt">value =</span> <span class="st">"N"</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># stack up the population sizes in each year</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(t) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">N=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(N)) <span class="co"># reduce to one row per year</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(stoch_summary, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x=</span>t, <span class="dt">y=</span>N)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()</a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>This works because we’ve stored the matrices in a list-column of the dataframe parms. We can do replicates as well.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">big_list_matrices &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="dt">t =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">time =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">                            <span class="dt">rep =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">                            <span class="co"># pick a matrix randomly 20 times</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">                            <span class="dt">A =</span> <span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(hh_A, <span class="dv">200</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span>(<span class="op">-</span>rep) <span class="co"># create a list of dataframes, one per rep defaults to name data</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb17-7" data-line-number="7">manyreps &lt;-<span class="st"> </span>big_list_matrices <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="st">  </span><span class="co"># we've used map() and friends before, runs our model with each element of a list</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">data =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(data, <span class="cf">function</span>(X) <span class="kw"><a href="../reference/iterate.html">iterate</a></span>(<span class="dt">parms =</span> X, <span class="dt">N0 =</span> hh_N<span class="op">$</span>N1991, <span class="dt">popfun =</span> stoch_proj))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span>() <span class="co"># pop everything back out of the list of dataframes</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"></a>
<a class="sourceLine" id="cb17-12" data-line-number="12">stoch_summary &lt;-<span class="st"> </span>manyreps <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="dt">key =</span> <span class="st">"ageclass"</span>, <span class="dt">value =</span> <span class="st">"N"</span>, <span class="dv">4</span><span class="op">:</span><span class="dv">13</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># stack up the population sizes in each year</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(t, rep) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">N=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(N)) <span class="co"># reduce to one row per year</span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(stoch_summary, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x=</span>t, <span class="dt">y=</span>N, <span class="dt">group=</span>rep)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()</a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Deriving that is a bit complicated. <span class="math inline">\(d\)</span> is the death rate in continuous time. The probability of 0 deaths in an interval of time is <span class="math inline">\(p(deaths = 0) = e^{-d}\)</span>, which is the zero term of a Poisson distribution. We need the probability of at least 1 death so <span class="math inline">\(p(death &gt; 0) = 1 - e^{-d}\)</span> by the law of total probability.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#exponential-growth">Exponential growth</a></li>
      <li>
<a href="#stochasticity">Stochasticity</a><ul class="nav nav-pills nav-stacked">
<li><a href="#sampling-error---epistemic-uncertainty">Sampling error - Epistemic uncertainty</a></li>
      <li><a href="#environmental-stochasticity">Environmental stochasticity</a></li>
      <li><a href="#demographic-stochasticity">Demographic stochasticity</a></li>
      <li><a href="#structured-population-models">Structured Population Models</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Drew Tyre.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
